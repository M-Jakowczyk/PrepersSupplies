<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="PrepersSupplies.ProductDetailsPage"
             Title="SzczegÃ³Å‚y produktu">

    <Grid RowDefinitions="Auto,*,Auto">
        
        <!-- NagÅ‚Ã³wek z informacjami o produkcie -->
        <StackLayout Grid.Row="0" Padding="15" BackgroundColor="#2196F3" Spacing="5">
            <Label Text="{Binding Product.Name}" 
                   FontSize="20" 
                   FontAttributes="Bold" 
                   TextColor="White"/>
            <Label Text="{Binding Product.Barcode, StringFormat='Kod: {0}'}" 
                   FontSize="14" 
                   TextColor="White"
                   Opacity="0.8"/>
        </StackLayout>

        <!-- GÅ‚Ã³wna zawartoÅ›Ä‡ -->
        <ScrollView Grid.Row="1">
            <StackLayout Padding="15" Spacing="15">
                
                <!-- Sekcja: Rekordy przydatnoÅ›ci -->
                <Frame Padding="12" BackgroundColor="White" BorderColor="#E0E0E0" CornerRadius="8">
                    <StackLayout Spacing="10">
                        <Label Text="ðŸ“… Rekordy przydatnoÅ›ci:" 
                               FontSize="16" 
                               FontAttributes="Bold"
                               TextColor="Black"/>
                        
                        <!-- Lista rekordÃ³w -->
                        <CollectionView ItemsSource="{Binding Product.ExpiryRecords}">
                            <CollectionView.EmptyView>
                                <Label Text="Brak rekordÃ³w - dodaj nowy klikajÄ…c poniÅ¼ej" 
                                       FontSize="12" 
                                       TextColor="Gray"
                                       HorizontalOptions="Center"
                                       Margin="0,10"/>
                            </CollectionView.EmptyView>

                            <CollectionView.ItemTemplate>
                                <DataTemplate>
                                    <Frame Margin="0,5" Padding="10" BackgroundColor="#F5F5F5" BorderColor="#E0E0E0" CornerRadius="6">
                                        <Grid ColumnDefinitions="*,Auto,Auto,Auto" ColumnSpacing="5">
                                            <!-- Dane rekordu -->
                                            <StackLayout Grid.Column="0" Spacing="5">
                                                <Label Text="{Binding ExpiryDate, StringFormat='ðŸ“… {0:yyyy-MM-dd}'}" 
                                                       FontSize="13" 
                                                       FontAttributes="Bold"
                                                       TextColor="#D32F2F"/>
                                                <Label Text="{Binding Quantity, StringFormat='ðŸ“¦ IloÅ›Ä‡: {0} szt.'}" 
                                                       FontSize="12" 
                                                       TextColor="#388E3C"/>
                                            </StackLayout>

                                            <!-- Przycisk zmniejszenia iloÅ›ci -->
                                            <Button Grid.Column="1" 
                                                    Text="âˆ’" 
                                                    Clicked="OnDecreaseRecordQuantityClicked"
                                                    BackgroundColor="#FFC107"
                                                    TextColor="Black"
                                                    FontSize="18"
                                                    Padding="5"
                                                    WidthRequest="40"
                                                    HeightRequest="40"
                                                    CornerRadius="20"
                                                    FontAttributes="Bold"
                                                    CommandParameter="{Binding .}"/>

                                            <!-- Przycisk zwiÄ™kszenia iloÅ›ci -->
                                            <Button Grid.Column="2" 
                                                    Text="+" 
                                                    Clicked="OnIncreaseRecordQuantityClicked"
                                                    BackgroundColor="#4CAF50"
                                                    TextColor="White"
                                                    FontSize="18"
                                                    Padding="5"
                                                    WidthRequest="40"
                                                    HeightRequest="40"
                                                    CornerRadius="20"
                                                    FontAttributes="Bold"
                                                    CommandParameter="{Binding .}"/>

                                            <!-- Przycisk usuwania -->
                                            <Button Grid.Column="3" 
                                                    Text="ðŸ—‘ï¸" 
                                                    Clicked="OnDeleteExpiryRecordClicked"
                                                    BackgroundColor="#F44336"
                                                    TextColor="White"
                                                    FontSize="14"
                                                    Padding="5"
                                                    WidthRequest="40"
                                                    HeightRequest="40"
                                                    CornerRadius="20"
                                                    CommandParameter="{Binding .}"/>
                                        </Grid>
                                    </Frame>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>

                        <!-- Sekcja dodawania nowego rekordu -->
                        <Frame Padding="12" BackgroundColor="#F0F8F0" BorderColor="#4CAF50" CornerRadius="8" Margin="0,10,0,0">
                            <StackLayout Spacing="12">
                                <Label Text="âž• Dodaj nowy rekord" 
                                       FontSize="14" 
                                       FontAttributes="Bold"
                                       TextColor="#2E7D32"/>

                                <!-- WybÃ³r daty -->
                                <StackLayout Spacing="5">
                                    <Label Text="ðŸ“… Data przydatnoÅ›ci:" 
                                           FontSize="12" 
                                           TextColor="#333"
                                           FontAttributes="Bold"/>
                                    
                                    <!-- Przyciski skanowania i wyboru daty -->
                                    <Grid ColumnDefinitions="*,Auto" ColumnSpacing="8">
                                        <DatePicker Grid.Column="0"
                                                    x:Name="ExpiryDatePicker"
                                                    Date="{Binding NewExpiryDate}"
                                                    Format="yyyy-MM-dd"
                                                    FontSize="13"
                                                    BackgroundColor="White"
                                                    Margin="0,2"/>
                                        
                                        <Button Grid.Column="1"
                                                Text="ðŸ“·"
                                                Clicked="OnScanDateClicked"
                                                BackgroundColor="#2196F3"
                                                TextColor="White"
                                                FontSize="18"
                                                Padding="8"
                                                WidthRequest="50"
                                                HeightRequest="50"
                                                CornerRadius="25"
                                                ToolTipProperties.Text="Skanuj datÄ™ przydatnoÅ›ci"/>
                                    </Grid>
                                </StackLayout>

                                <!-- WybÃ³r iloÅ›ci -->
                                <StackLayout Spacing="5">
                                    <Label Text="ðŸ“¦ IloÅ›Ä‡ (szt):" 
                                           FontSize="12" 
                                           TextColor="#333"
                                           FontAttributes="Bold"/>
                                    <Grid ColumnDefinitions="*,Auto,*,Auto" ColumnSpacing="8">
                                        <!-- Spinner (Entry) do iloÅ›ci -->
                                        <Entry Grid.Column="0"
                                               x:Name="QuantityEntry"
                                               Text="{Binding NewQuantity}"
                                               Placeholder="Liczba"
                                               Keyboard="Numeric"
                                               FontSize="13"
                                               BackgroundColor="White"
                                               HorizontalTextAlignment="Center"/>
                                        
                                        <!-- Przycisk minus -->
                                        <Button Grid.Column="1"
                                                Text="âˆ’"
                                                Clicked="OnDecreaseQuantityClicked"
                                                BackgroundColor="#FFC107"
                                                TextColor="Black"
                                                FontSize="18"
                                                Padding="5"
                                                WidthRequest="40"
                                                HeightRequest="40"
                                                CornerRadius="20"
                                                FontAttributes="Bold"/>

                                        <!-- Label iloÅ›ci -->
                                        <Label Grid.Column="2"
                                               Text="{Binding NewQuantity}"
                                               FontSize="14"
                                               FontAttributes="Bold"
                                               TextColor="#388E3C"
                                               HorizontalOptions="Center"
                                               VerticalOptions="Center"/>

                                        <!-- Przycisk plus -->
                                        <Button Grid.Column="3"
                                                Text="+"
                                                Clicked="OnIncreaseQuantityClicked"
                                                BackgroundColor="#4CAF50"
                                                TextColor="White"
                                                FontSize="18"
                                                Padding="5"
                                                WidthRequest="40"
                                                HeightRequest="40"
                                                CornerRadius="20"
                                                FontAttributes="Bold"/>
                                    </Grid>
                                </StackLayout>

                                <!-- Przycisk dodawania -->
                                <Button Text="âœ… Dodaj rekord" 
                                        Clicked="OnConfirmAddExpiryRecordClicked"
                                        BackgroundColor="#4CAF50"
                                        TextColor="White"
                                        FontSize="14"
                                        Padding="10"
                                        FontAttributes="Bold"/>
                            </StackLayout>
                        </Frame>
                    </StackLayout>
                </Frame>

                <!-- Edycja nazwy produktu -->
                <Frame Padding="12" BackgroundColor="White" BorderColor="#E0E0E0" CornerRadius="8">
                    <StackLayout Spacing="8">
                        <Label Text="ðŸ“ Edytuj nazwÄ™:" 
                               FontSize="14" 
                               FontAttributes="Bold"
                               TextColor="Black"/>
                        <Entry x:Name="ProductNameEntry"
                               Text="{Binding Product.Name}" 
                               Placeholder="Wpisz nazwÄ™ produktu"
                               FontSize="14"
                               Margin="0,5"/>
                    </StackLayout>
                </Frame>

                <!-- Statystyka -->
                <Frame Padding="12" BackgroundColor="#E3F2FD" BorderColor="#2196F3" CornerRadius="8">
                    <StackLayout Spacing="8">
                        <Label Text="ðŸ“Š Statystyka:" 
                               FontSize="14" 
                               FontAttributes="Bold"
                               TextColor="#2196F3"/>
                        <Label Text="{Binding Product.TotalQuantity, StringFormat='CaÅ‚kowita iloÅ›Ä‡: {0} szt.'}" 
                               FontSize="13" 
                               TextColor="Black"/>
                        <Label Text="{Binding Product.NearestExpiryDate, StringFormat='NajbliÅ¼sza waÅ¼noÅ›Ä‡: {0:yyyy-MM-dd}'}" 
                               FontSize="13" 
                               TextColor="#D32F2F"
                               FontAttributes="Bold"/>
                    </StackLayout>
                </Frame>
            </StackLayout>
        </ScrollView>

        <!-- Przyciski akcji (Anuluj/Zapisz) -->
        <StackLayout Grid.Row="2" 
                     Orientation="Horizontal" 
                     Padding="15" 
                     Spacing="10"
                     BackgroundColor="#F5F5F5">
            <Button Text="âŒ Anuluj" 
                    Clicked="OnCancelClicked"
                    BackgroundColor="#999999"
                    TextColor="White"
                    FontSize="14"
                    HorizontalOptions="FillAndExpand"/>
            <Button Text="âœ… Zapisz" 
                    Clicked="OnSaveClicked"
                    BackgroundColor="#4CAF50"
                    TextColor="White"
                    FontSize="14"
                    HorizontalOptions="FillAndExpand"/>
        </StackLayout>

    </Grid>

</ContentPage>
