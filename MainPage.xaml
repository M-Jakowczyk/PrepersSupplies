<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="PrepersSupplies.MainPage">

    <Grid RowDefinitions="Auto,Auto,Auto,Auto,*">
        
        <!-- Nagłówek aplikacji -->
        <StackLayout Grid.Row="0" Padding="15" BackgroundColor="#2196F3">
            <Label Text="📦 Preppers Supplies" 
                   FontSize="24" 
                   FontAttributes="Bold" 
                   TextColor="White"
                   HorizontalOptions="Center"/>
            <Label Text="Menedżer zapasów spożywczych" 
                   FontSize="14" 
                   TextColor="White"
                   HorizontalOptions="Center"/>
        </StackLayout>

        <!-- Przycisk skanowania -->
        <Button Grid.Row="1" 
                x:Name="ScanButton"
                Text="📷 SKANUJ KOD KRESKOWY" 
                Clicked="OnScanButtonClicked"
                FontSize="18"
                FontAttributes="Bold"
                BackgroundColor="#4CAF50"
                TextColor="White"
                Margin="15,10"
                Padding="15"
                CornerRadius="10"/>

        <!-- Status ostatniego skanowania -->
        <Frame Grid.Row="2" 
               Margin="15,5" 
               Padding="10" 
               BackgroundColor="#F5F5F5"
               CornerRadius="8"
               HasShadow="True">
            <Label x:Name="LastScannedLabel" 
                   FontSize="14" 
                   Text="Naciśnij przycisk, aby zeskanować pierwszy produkt"
                   HorizontalOptions="Center"
                   TextColor="Gray"/>
        </Frame>

        <!-- Pole wyszukiwania -->
        <StackLayout Grid.Row="3" Padding="15,10,15,5" Spacing="5">
            <SearchBar x:Name="SearchBar"
                       Placeholder="🔍 Wyszukaj po nazwie lub kodzie..."
                       SearchButtonPressed="OnSearchButtonPressed"
                       TextChanged="OnSearchTextChanged"
                       FontSize="14"/>
            <StackLayout Orientation="Horizontal" Spacing="10">
                <Button Text="🔄 Pokaż wszystkie" 
                        Clicked="OnShowAllClicked"
                        BackgroundColor="#2196F3"
                        TextColor="White"
                        FontSize="12"
                        Padding="10,5"
                        HorizontalOptions="FillAndExpand"/>
                <Button Text="📅 Ważne w 7 dni" 
                        Clicked="OnShowExpiringSoonClicked"
                        BackgroundColor="#FF9800"
                        TextColor="White"
                        FontSize="12"
                        Padding="10,5"
                        HorizontalOptions="FillAndExpand"/>
            </StackLayout>
        </StackLayout>

        <!-- Lista produktów -->
        <Grid Grid.Row="4" Padding="15,0" RowDefinitions="Auto,*">
            <Label Grid.Row="0"
                   Text="📋 Zeskanowane produkty:" 
                   FontSize="18" 
                   FontAttributes="Bold"
                   Margin="0,10,0,5"/>
            <CollectionView Grid.Row="1" ItemsSource="{Binding ScannedCodes}">
                    <CollectionView.EmptyView>
                        <StackLayout Padding="20">
                            <Label Text="Brak zeskanowanych produktów" 
                                   FontSize="14" 
                                   TextColor="Gray"
                                   HorizontalOptions="Center"/>
                            <Label Text="Użyj przycisku powyżej, aby rozpocząć skanowanie" 
                                   FontSize="12" 
                                   TextColor="Gray"
                                   HorizontalOptions="Center"
                                   Margin="0,5,0,0"/>
                        </StackLayout>
                    </CollectionView.EmptyView>

                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <Frame Margin="0,5" 
                                   Padding="12" 
                                   BackgroundColor="White"
                                   BorderColor="#E0E0E0"
                                   CornerRadius="8"
                                   HasShadow="False">
                                <Grid RowDefinitions="Auto,Auto,Auto,Auto" ColumnDefinitions="Auto,*" RowSpacing="5">
                                    <!-- Nazwa produktu i kod -->
                                    <Label Grid.Row="0" Grid.ColumnSpan="4"
                                           Text="{Binding Name}" 
                                           FontSize="16" 
                                           FontAttributes="Bold"
                                           TextColor="Black"/>
                                    
                                    <!-- Szczegóły: Data + Ilość -->
                                    <StackLayout Grid.Row="1" Grid.Column="0"
                                               Orientation="Horizontal" 
                                               Spacing="15">
                                        <!-- Najbliższa data przydatności -->
                                        <StackLayout Spacing="2">
                                            <Label Text="📅 Przydatny do:" 
                                                   FontSize="11" 
                                                   TextColor="Gray"/>
                                            <Label Text="{Binding NearestExpiryDate, StringFormat='{0:yyyy-MM-dd}'}" 
                                                   FontSize="13" 
                                                   FontAttributes="Bold"
                                                   TextColor="#D32F2F"/>
                                        </StackLayout>

                                        <!-- Całkowita ilość -->
                                        <StackLayout Spacing="2">
                                            <Label Text="📦 Ilość:" 
                                                   FontSize="11" 
                                                   TextColor="Gray"/>
                                            <Label Text="{Binding TotalQuantity}" 
                                                   FontSize="13" 
                                                   FontAttributes="Bold"
                                                   TextColor="#388E3C"/>
                                        </StackLayout>
                                    </StackLayout>

                                    <!-- Kod kreskowy -->
                                    <Label Grid.Row="2" Grid.Column="0"
                                           Text="{Binding Barcode, StringFormat='Kod: {0}'}" 
                                           FontSize="11" 
                                           TextColor="#9E9E9E"
                                           Margin="0,5,0,0"/>
                                    
                                    <!-- Przyciski akcji (Edit, Delete) -->
                                    <StackLayout Grid.Column="1" Grid.Row="1" Grid.RowSpan="3"
                                                 Orientation="Horizontal" 
                                                 Spacing="10"
                                                 Margin="0,10,0,0">
                                        <Button Text="✏️ Edytuj" 
                                                Clicked="OnEditProductClicked"
                                                BackgroundColor="#FF9800"
                                                TextColor="White"
                                                FontSize="12"
                                                Padding="10,5"
                                                HorizontalOptions="FillAndExpand"
                                                CommandParameter="{Binding .}"/>
                                        <Button Text="🗑️ Usuń" 
                                                Clicked="OnDeleteProductClicked"
                                                BackgroundColor="#F44336"
                                                TextColor="White"
                                                FontSize="12"
                                                Padding="10,5"
                                                HorizontalOptions="FillAndExpand"
                                                CommandParameter="{Binding .}"/>
                                    </StackLayout>
                                </Grid>
                            </Frame>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </Grid>
    </Grid>

</ContentPage>
